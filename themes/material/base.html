{% macro asset(path) -%}
/_app/{{config.VERSION}}/config/{{path}}
{%- endmacro %}

{% macro render_menu(folder, indent=True) %}
  {% if indent %}
    <li><a href="{{folder.url}}">{{folder.title}}</a>
  {% endif %}
  {% if indent %}<ul>{% endif %}
    {% for sub_folder in folder.children['folders'] %}
    <li><a href="{{sub_folder.url}}">{{sub_folder.title}}</a></li>
    {% endfor %}
    {% for page in folder.children['pages'] %}
    <li><a href="{{page.url}}">{{page.title}}</a></li>
    {% endfor %}
  {% if indent %}</ul>{% endif %}
{% endmacro %}

<!doctype html>
<meta charset="utf-8">
<meta content="IE=Edge" http-equiv="X-UA-Compatible">
<meta content="width=device-width,initial-scale=1.0,user-scalable=no" name="viewport">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=RobotoDraft:400,500,700,400italic" rel="stylesheet">
<link rel="stylesheet" href="/_app/{{config.VERSION}}/assets/css/main.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
<title>{{config.CONFIG.title}}</title>
<body>
  <div class="layout">
    {% if enable_sidebar is not sameas false %}
    <div class="layout-side">
      <div class="layout-side-top">
        <a href="{{uri_for('home')}}"><img src="{{asset(config.CONFIG.logo)}}" class="layout-side-top-logo"></a>
        <div class="layout-side-top-subtitle">{{config.CONFIG.sidebar_title|safe}}</div>
      </div>
      <ul>
        {% for folder in folders %}
          {% if folder.weight != -1 %}{% continue %}{% endif %}
          {{render_menu(folder, indent=False)}}
        {% endfor %}
      </ul>
      <div class="layout-side-bordered">
        <ul>
          {% for folder in folders %}
            {% if folder.weight == -1 %}{% continue %}{% endif %}
            {{render_menu(folder)}}
          {% endfor %}
        </ul>
      </div>
      <div class="layout-side-bottom">
        {{config.CONFIG.sidebar|safe}}
      </div>
    </div>
    {% endif %}
    <div class="layout-main">
      <div class="layout-main-header">
        <div class="layout-main-header-title">
          {{title}}
        </div>
        <div class="layout-main-header-side">
          <a href="{{uri_for('settings')}}">{{user.email()}}</a>
        </div>
      </div>
      <div class="layout-main-content">
        {% block main %}
        {% endblock %}
      </div>
    </div>
  </div>
