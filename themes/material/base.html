{% import "_macros.html" as macros with context %}
<!doctype html>
<head>
  <meta charset="utf-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width,initial-scale=1.0,user-scalable=no" name="viewport">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=RobotoDraft:400,500,700,400italic" rel="stylesheet">
  <link rel="stylesheet" href="/_app/{{config.VERSION}}/assets/css/main.css">
  <script src="/_app/{{config.VERSION}}/assets/js/main.min.js"></script>
  {% if config.CONFIG.favicon_url %}
  <link rel="shortcut icon" href="{{config.CONFIG.favicon_url}}">
  {% endif %}
  <title>{{config.CONFIG.title}}</title>
</head>
<body>
  <ul style="display: none">
    {% for folder in folders %}
      {{macros.render_menu_tree(folder)}}
    {% endfor %}
  </ul>
  <div class="layout">
    {% if enable_sidebar is not sameas false %}
    <div class="layout-side">
      <div class="layout-side-top">
        <a href="{{uri_for('home')}}">
          {% if config.CONFIG.logo %}
            <img src="{{macros.asset(config.CONFIG.logo)}}" class="layout-side-top-logo">
          {% elif config.CONFIG.logo_url %}
            <img src="{{config.CONFIG.logo_url}}" class="layout-side-top-logo">
          {% else %}
            {{config.CONFIG.title or config.CONFIG.sidebar_title}}
          {% endif %}
        </a>
        <div class="layout-side-top-subtitle">{{config.CONFIG.sidebar_title|safe}}</div>
      </div>
      {% block side %}
        <ul>
          {% for folder in folders %}
            {% if folder.weight != -1 %}{% continue %}{% endif %}
            {{macros.render_menu(folder, indent=False, active_page=page, combined=true)}}
            {#
            {% set children = folder.list_children()['folders'] %}
            #}
          {% endfor %}
        </ul>
 
        <div class="layout-side-bordered">
          <ul>
            {% for each_folder in folders %}
              {% if each_folder.weight == -1 %}{% continue %}{% endif %}
              {% if page %}
                {{macros.render_menu(each_folder, active_folder=page.parent, active_page=page)}}
              {% elif folder %}
                {{macros.render_menu(each_folder, active_folder=folder)}}
              {% else %}
                {{macros.render_menu(each_folder)}}
              {% endif %}
            {% endfor %}
          </ul>
        </div>
        <div class="layout-side-bottom">
          {{config.CONFIG.sidebar|safe}}
        </div>
      {% endblock %}
    </div>
    {% endif %}
    <div class="layout-main">
      <div class="layout-main-header">
        {% if enable_sidebar is sameas false %}
          <div class="contained contained--sm">
        {% endif %}
        <div class="layout-main-header-title">
          {{title}}
        </div>
        <div class="layout-main-header-side">
          {% if me.registered %}
            <a href="{{uri_for('settings')}}">{{me.email}}</a> | <a href="{{urls.sign_out()}}">Sign out</a>
          {% else %}
            <a href="{{urls.sign_in()}}" class="btn btn--sm btn--inverted">Sign in</a>
          {% endif %}
        </div>
        {% if enable_sidebar is sameas false %}
          </div>
        {% endif %}
      </div>
      <div class="layout-main-content">
        {% block main %}
        {% endblock %}
      </div>
    </div>
  </div>
  {% block body_base %}{% endblock %}
