{% macro asset(path) -%}
/_app/{{config.VERSION}}/config/{{path}}
{%- endmacro %}

{% macro render_menu_tree(resource, config, active_resource_id=None) %}
  {% if 'folder' in resource and resource['folder'] %}
    {% set resource = resource['folder'] %}
  {% endif %}
  {% if 'children' in resource and not resource['is_asset_folder'] %}
    {% set has_children = true %}
    {% set url = "javascript:" %}
  {% else %}
    {% set has_children = false %}
    {% set url = resource['url'] %}
  {% endif %}
  <li class="{{"menu-item-child--open" if resource['resource_id'] == active_resource_id or config.keep_folders_open}}"><a
    href="{{url}}"
    class="{{"menu-item--folder" if has_children}} {{"menu-item--active" if resource['resource_id'] == active_resource_id and not has_children}}"
    >{{resource['title']}}
    {% if not config.keep_folders_open %}
      {% if has_children %}<i class="material-icons">expand_more</i>{% endif %}
    {% endif %}
    </a></li>
  {% if has_children %}
    <ul class="menu-item--child {{"menu-item-child--open"
      if (folder and resource['resource_id'] in folder.resource_id
            or page and resource['resource_id'] in page.resource_id)
          or config.keep_folders_open}}">
      {% for item in resource['children']['items']|sort(attribute='weight') %}
        {{render_menu_tree(item, config, active_resource_id=active_resource_id)}}
      {% endfor %}
    </ul>
  {% endif %}
{% endmacro %}

{% macro render_admin_bar(resource) %}
<div ng-controller="SyncController as ctrl" ng-cloak>
  <div class="snackbar" ng-if="ctrl.error">
    An error occured.
  </div>
  <div class="snackbar" ng-if="ctrl.loading">
    Syncing...
  </div>
  <div class="snackbar" ng-if="ctrl.success">
    Done syncing. <a href=".">Refresh</a> or <a ng-click="ctrl.success = false; ctrl.loading == false" href="javascript:">dismiss</a>.
  </div>
  <div class="admin-bar">
    <a href="{{uri_for('admin')}}">Site Admin</a>
    <a href="{{resource.edit_url}}">Edit Page</a>
    {% if resource.parent.edit_url %}
    <a href="{{resource.parent.edit_url}}">Edit Folder</a>
    {% endif %}
    <a href="javascript:" ng-click="ctrl.sync('{{resource.parent.resource_id}}')">Sync Folder</a>
    <a href="javascript:" ng-click="ctrl.sync('{{resource.resource_id}}')">Sync Page</a>
    <a href="{{uri_for('delete', resource_id=resource.resource_id)}}">Delete</a>
  </div>
</div>
{% endmacro %}

{% macro render_mosaic(resource_id) %}
  {% include "_mosaic.html" with context %}
{% endmacro %}

{% macro render_assets(assets) %}
  <div class="assets">
    {% for group in assets|groupby('basename') %}
      <div class="assets-asset">
        <div class="assets-asset-image">
          {% if group.list[0].title.endswith('.eps')
              and group.list[1]
              and not group.list[1].title.endswith('.eps') %}
            {% set thumbnail_item = group.list[1] %}
          {% else %}
            {% set thumbnail_item = group.list[0] %}
          {% endif %}
          <div class="assets-asset-image-thumbnail">
            <div class="assets-asset-image-thumbnail-image" style="background-image: url({{thumbnail_item.thumbnail_url}})"></div>
          </div>
        </div>
        <div class="assets-asset-meta">
          <div class="assets-asset-meta-title">
            {{thumbnail_item.title}}
          </div>
          {% for item in group.list %}
            <div class="assets-asset-meta-link">
              <a href="{{item.download_url}}">{{item.ext[1:]|upper}}</a> {{item.size|filesizeformat}}</li>
            </div>
          {% endfor %}
        </div>
      </div>
    {% endfor %}
  </div>
{% endmacro %}
