{% macro asset(path) -%}
/_app/{{config.VERSION}}/config/{{path}}
{%- endmacro %}

{% macro render_menu_tree(resource) %}
  <li>{{resource.title}}</li>
  {% if resource.resource_type == 'Folder' %}
    {% if resource.children['pages'] or resource.children['folders'] %}
      <ul>
        {% for item in resource.children['folders'] %}
          {{render_menu_tree(item)}}
        {% endfor %}
        {% for item in resource.children['pages'] %}
          {{render_menu_tree(item)}}
        {% endfor %}
      </ul>
    {% endif %}
  {% endif %}
{% endmacro %}

{% macro render_admin_bar(resource) %}
<div class="admin-bar">
  <a href="{{uri_for('admin')}}">Admin</a>
  <a href="{{resource.edit_url}}">Edit</a>
  <a href="{{resource.sync_url}}">Sync</a>
  <a href="{{uri_for('delete', resource_id=resource.resource_id)}}">Delete</a>
</div>
{% endmacro %}

{% macro render_menu(folder, indent=True, active_folder=None, active_page=None, combined=false) %}
  {% if indent %}
    <a href="{{folder.url}}" class="{{"active" if (folder == active_folder or folder == active_folder.parent)}}">
      {{folder.title}}
      <i class="material-icons">expand_more</i>
    </a>
  {% endif %}
  {% if indent %}<ul class="{{"active" if (folder == active_folder or folder == active_folder.parent)}}">{% endif %}
    {% if combined %}
      {% for item in folder.children['items'] %}
      <li class="{{"active-item" if item in [active_folder, active_page]}}"><a href="{{item.url}}">{{item.title}}</a></li>
      {% endfor %}
    {% else %}
      {% for sub_folder in folder.children['folders'] %}
      <li class="{{"active-item" if sub_folder == active_folder}}"><a href="{{sub_folder.url}}">{{sub_folder.title}}</a></li>
      {% endfor %}
      {% for page in folder.children['pages'] %}
      <li class="{{"active-item" if page == active_page}}"><a href="{{page.url}}">{{page.title}}</a></li>
      {% endfor %}
    {% endif %}
  {% if indent %}</ul>{% endif %}
{% endmacro %}

{% macro render_mosaic(resource_id) %}
  {% include "_mosaic.html" with context %}
{% endmacro %}

{% macro render_assets(assets) %}
  <div class="assets">
    {% for group in assets|groupby('basename') %}
      <div class="assets-asset">
        <div class="assets-asset-image">
          {% if group.list[0].title.endswith('.eps')
              and group.list[1]
              and not group.list[1].title.endswith('.eps') %}
            {% set thumbnail_item = group.list[1] %}
          {% else %}
            {% set thumbnail_item = group.list[0] %}
          {% endif %}
          <div class="assets-asset-image-thumbnail" style="background-image: url({{thumbnail_item.thumbnail_url}})"></div>
        </div>
        <div class="assets-asset-meta">
          <div class="assets-asset-meta-title">
            {{thumbnail_item.title}}
          </div>
          {% for item in group.list %}
            <div class="assets-asset-meta-link">
              <a href="{{item.download_url}}">{{item.ext[1:]|upper}}</a> {{item.size|filesizeformat}}</li>
            </div>
          {% endfor %}
        </div>
      </div>
    {% endfor %}
  </div>
{% endmacro %}
